<%- headers = ["Product SKU", "Product Title", "Type", "Supplier Factory", "Category", "Sub-Category", "Carton #", "Carton Length", "Carton Width", "Carton Height", "Carton Weight"] -%>
<%= CSV.generate_line headers -%>
<%- @products.each do |product| -%>
  <%- product.carton_details.each do |carton_detail| -%>
    <%- if carton_detail == product.carton_details.first -%>
<%= CSV.generate_line([product.sku, product.title, product.product_type, product.supplier&.name, product.category&.title, product.subcategory&.name, carton_detail.index, carton_detail.length, carton_detail.width, carton_detail.height, carton_detail.weight]).html_safe -%>
    <%- else -%>
<%= CSV.generate_line(["''", "''", "''", "''", "''", "''", carton_detail.index, carton_detail.length, carton_detail.width, carton_detail.height, carton_detail.weight]).html_safe -%>
    <%- end -%>
  <%- end -%>
<%- end -%>