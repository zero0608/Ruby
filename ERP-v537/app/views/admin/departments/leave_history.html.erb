<div class="container px-4">
  <div class="row mb-3">
    <div class="col-12">
      <span class="header1">Leave History</span>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-borderless table-hover">
          <thead>
            <tr>
              <th style="width: 10%">Name</th>
              <th style="width: 10%">Position</th>
              <th style="width: 15%">Requested</th>
              <th style="width: 15%">Requested Date</th>
              <th style="width: 15%">Status</th>
              <th style="width: 15%">Approval Date</th>
              <th style="width: 15%">Approved By</th>
              <th style="width: 5%">Action</th>
            </tr>
          </thead>
          <tbody>
            <% Leave.joins(:employee).where(employees: { department_id: @department.id }).where(status: ["Approved", "Declined"]).order(created_at: :desc).each do |leave| %>
              <tr>
                <td><%= leave.employee.full_name.titleize %></td>
                <td><%= leave.employee.position.name.titleize %></td>
                <td>
                  <%= leave.duration == leave.duration.to_i ? leave.duration.to_i : leave.duration %>
                  <%= "Day".pluralize(leave.duration) %>
                </td>
                <td><%= leave.created_at.strftime("%B %d, %Y") %></td>
                <td>
                  <% case leave.status %>
                    <% when "Approved" %>
                      <span class="badge badge-outline-green">Approved</span>
                    <% when "Declined" %>
                      <span class="badge badge-outline-black">Declined</span>
                  <% end %>
                </td>
                <td><%= leave.approval_date&.strftime("%B %d, %Y") %></td>
                <td><%= User.find_by(id: leave.approved_by_id)&.username&.titleize %></td>
                <td>
                  <% if leave.status == "Approved" %>
                    <a href="<%= cancel_leave_admin_leave_path(leave.id) %>" data-confirm="This leave request will be set to 'Declined' and <%= leave.employee.full_name %> will receive <%= leave.duration %> <%= "day".pluralize(leave.duration) %> back. Are you sure you want to do this?">
                      <%= show_svg("close.svg") %>
                    </a>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>