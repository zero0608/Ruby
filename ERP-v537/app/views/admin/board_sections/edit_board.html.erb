<div class="container h-100 px-4">
  <%= render partial: "/admin/tasks/navigation", local: { current_user: current_user } %>

  <div class="row position-relative" style="height: calc(100% - 56px - 1rem); top: calc(57px + 1rem)">
    <div class="col-2 h-100 d-flex flex-column">
      <div class="row">
        <div class="col-6">
          <p class="header2">EM Content</p>
        </div>
        <div class="col-6 text-right">
          <a data-toggle="modal" data-target="#newSectionModal">
            New Section
          </a>
        </div>
        <div class="col-12 mb-3">
          <div class="w-100 border-bottom"></div>
        </div>
      </div>
      <div class="flex-auto jstree-default">
        <ul class="jstree-container-ul">
          <% BoardSection.where(main_board: nil).order(:position).each do |section| %>
            <li class="jstree-node jstree-leaf <%= "jstree-last" if section.position == BoardSection.where(main_board: nil).maximum(:position) %>">
              <i class="jstree-icon jstree-ocl"></i>
              <i class="jstree-icon jstree-themeicon"></i>
              <div class="li-text d-inline-block position-relative" style="width: calc(100% - 56px)">
                <span class="d-inline-block w-100 text-grey <%= "font-italic" unless section.name.present? %>">
                  <%= section.name.present? ? section.name : "New Section" %>
                </span>
                <div class="li-menu position-absolute" style="top: 0; right: 0">
                  <% unless section.position == BoardSection.where(main_board: nil).minimum(:position) %>
                    <span class="cursor-pointer mr-3" data-reflex="click->BoardSectionReflex#increase_position" data-reflex-root=".jstree-default" data-id="<%= section.id %>" data-type="section">
                      <%= show_svg("arrow.svg") %>
                    </span>
                  <% end %>
                  <% unless section.position == BoardSection.where(main_board: nil).maximum(:position) %>
                    <span class="cursor-pointer icon-bottom mr-3" data-reflex="click->BoardSectionReflex#decrease_position" data-reflex-root=".jstree-default" data-id="<%= section.id %>" data-type="section">
                      <%= show_svg("arrow.svg") %>
                    </span>
                  <% end %>
                  <div class="hover-toggle">
                    <i class="dripicons-dots-3"></i>
                    <div class="hover-container dropdown-menu-right">
                      <div class="hover-menu">
                        <a href="<%= new_admin_board_page_path(board_section_id: section.id) %>">
                          <div class="hover-item">Add Page</div>
                        </a>
                        <%= link_to edit_board_admin_board_sections_path(create_section_id: section.id), remote: true do %>
                          <div class="hover-item">Add Section</div>
                        <% end %>
                        <% if BoardSection.where(main_board: nil).count > 1 %>
                          <% if section.board_pages.count > 0 || BoardSection.where(main_board: section.id).present? %>
                            <%= link_to edit_board_admin_board_sections_path(delete_section_id: section.id), remote: true do %>
                              <div class="hover-item">Delete Section</div>
                            <% end %>
                          <% else %>
                            <a href="<%= delete_board_admin_board_sections_path(section_id: section.id) %>">
                              <div class="hover-item">Delete Section</div>
                            </a>
                          <% end %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <% if section.board_pages.present? || BoardSection.where(main_board: section.id).present? %>
                <ul class="jstree-children">
                  <% if BoardSection.where(main_board: section.id).present? %>
                    <% BoardSection.where(main_board: section.id).order(:position).each do |ss| %>
                      <li class="jstree-node jstree-leaf <%= "jstree-last" if ss.position == BoardSection.where(main_board: section.id).maximum(:position) && section.board_pages.count == 0 %>">
                        <i class="jstree-icon jstree-ocl"></i>
                        <i class="jstree-icon jstree-themeicon"></i>
                        <div class="li-text d-inline-block position-relative" style="width: calc(100% - 56px)">
                          <span class="d-inline-block w-100 text-grey <%= "font-italic" unless ss.name.present? %>">
                            <%= ss.name.present? ? ss.name : "New Section" %>
                          </span>
                          <div class="li-menu position-absolute" style="top: 0; right: 0">
                            <% unless ss.position == BoardSection.where(main_board: section.id).minimum(:position) %>
                              <span class="cursor-pointer mr-3" data-reflex="click->BoardSectionReflex#increase_position" data-reflex-root=".jstree-default" data-id="<%= ss.id %>" data-type="section">
                                <%= show_svg("arrow.svg") %>
                              </span>
                            <% end %>
                            <% unless ss.position == BoardSection.where(main_board: section.id).maximum(:position) %>
                              <span class="cursor-pointer icon-bottom mr-3" data-reflex="click->BoardSectionReflex#decrease_position" data-reflex-root=".jstree-default" data-id="<%= ss.id %>" data-type="section">
                                <%= show_svg("arrow.svg") %>
                              </span>
                            <% end %>
                            <div class="hover-toggle">
                              <i class="dripicons-dots-3"></i>
                              <div class="hover-container dropdown-menu-right">
                                <div class="hover-menu">
                                  <a href="<%= new_admin_board_page_path(board_section_id: ss.id) %>">
                                    <div class="hover-item">Add Page</div>
                                  </a>
                                  <% if ss.board_pages.count > 0 %>
                                    <%= link_to edit_board_admin_board_sections_path(delete_section_id: ss.id), remote: true do %>
                                      <div class="dropdown-item">Delete Section</div>
                                    <% end %>
                                  <% else %>
                                    <a href="<%= delete_board_admin_board_sections_path(section_id: ss.id) %>">
                                      <div class="dropdown-item">Delete Section</div>
                                    </a>
                                  <% end %>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <% if ss.board_pages.present? %>
                          <ul class="jstree-children">
                            <% ss.board_pages.order(:position).each do |ss_page| %>
                              <li class="jstree-node jstree-leaf <%= "jstree-last" if ss_page.position == ss.board_pages.maximum(:position) %>">
                                <i class="jstree-icon jstree-ocl"></i>
                                <i class="jstree-icon jstree-file"></i>
                                <div class="li-text d-inline-block position-relative" style="width: calc(100% - 56px)">
                                  <%= link_to (ss_page.name.present? ? ss_page.name : "New Page"), edit_board_admin_board_sections_path(page_id: ss_page.id), class: "d-inline-block w-100 text-grey " + (ss_page.name.present? ? "" : "font-italic"), remote: true %>
                                  <div class="li-menu position-absolute" style="top: 0; right: 0">
                                    <% unless ss_page.position == ss.board_pages.minimum(:position) %>
                                      <span class="cursor-pointer mr-3" data-reflex="click->BoardSectionReflex#increase_position" data-reflex-root=".jstree-default" data-id="<%= ss_page.id %>" data-type="page">
                                        <%= show_svg("arrow.svg") %>
                                      </span>
                                    <% end %>
                                    <% unless ss_page.position == ss.board_pages.maximum(:position) %>
                                      <span class="cursor-pointer icon-bottom mr-3" data-reflex="click->BoardSectionReflex#decrease_position" data-reflex-root=".jstree-default" data-id="<%= ss_page.id %>" data-type="page">
                                        <%= show_svg("arrow.svg") %>
                                      </span>
                                    <% end %>
                                    <div class="hover-toggle">
                                      <i class="dripicons-dots-3"></i>
                                      <div class="hover-container dropdown-menu-right">
                                        <div class="hover-menu">
                                          <a data-reflex="click->BoardSectionReflex#delete_page" data-page-id="<%= ss_page.id %>">
                                            <div class="hover-item">Delete Page</div>
                                          </a>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </li>
                            <% end %>
                          </ul>
                        <% end %>
                      </li>
                    <% end %>
                  <% end %>

                  <% if section.board_pages.present? %>
                    <% section.board_pages.order(:position).each do |page| %>
                      <li class="jstree-node jstree-leaf <%= "jstree-last" if page.position == section.board_pages.maximum(:position) %>">
                        <i class="jstree-icon jstree-ocl"></i>
                        <i class="jstree-icon jstree-file"></i>
                        <div class="li-text d-inline-block position-relative" style="width: calc(100% - 56px)">
                          <%= link_to (page.name.present? ? page.name : "New Page"), edit_board_admin_board_sections_path(page_id: page.id), class: "d-inline-block w-100 text-grey " + (page.name.present? ? "" : "font-italic"), remote: true %>
                          <div class="li-menu position-absolute" style="top: 0; right: 0">
                            <% unless page.position == section.board_pages.minimum(:position) %>
                              <span class="cursor-pointer mr-3" data-reflex="click->BoardSectionReflex#increase_position" data-reflex-root=".jstree-default" data-id="<%= page.id %>" data-type="page">
                                <%= show_svg("arrow.svg") %>
                              </span>
                            <% end %>
                            <% unless page.position == section.board_pages.maximum(:position) %>
                              <span class="cursor-pointer icon-bottom mr-3" data-reflex="click->BoardSectionReflex#decrease_position" data-reflex-root=".jstree-default" data-id="<%= page.id %>" data-type="page">
                                <%= show_svg("arrow.svg") %>
                              </span>
                            <% end %>
                            <div class="hover-toggle">
                              <i class="dripicons-dots-3"></i>
                              <div class="hover-container dropdown-menu-right">
                                <div class="hover-menu">
                                  <a data-reflex="click->BoardSectionReflex#delete_page" data-page-id="<%= page.id %>">
                                    <div class="hover-item">Delete Page</div>
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </li>
                    <% end %>
                  <% end %>
                </ul>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div class="col-10 h-100" id="page-content">
      <% if @board_page.present? %>
        <%= render partial: "page_content", locals: { board_page: @board_page } %>
      <% end %>
    </div>
  </div>
</div>

<%= form_for [:admin, BoardSection.new], html: { class: "form-horizontal form-bordered" } do |f| %>
  <div class="modal" id="newSectionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-thin">
      <div class="modal-content">
        <div class="modal-header">
          <span class="header2 modal-title">New Section</span>
          <button type="button" class="close" data-dismiss="modal">
            <span class="text-black"><%= show_svg("close.svg") %></span>
          </button>
        </div>
        <div class="modal-body">
          <label>Name</label>
          <%= f.text_field :name, class: "form-control" %>
        </div>
        <div class="modal-footer">
          <span class="btn btn-secondary mr-4" data-dismiss="modal">Cancel</span>
          <%= submit_tag "Submit", class: "btn btn-primary" %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<div id="create-section"></div>
<div id="delete-section"></div>

<style>
  .li-text:hover { background: var(--light-blue) !important; }
  .li-text .li-menu { display: none; }
  .li-text:hover .li-menu { display: block; }
  .li-text .hover-container { padding: 0; }
</style>