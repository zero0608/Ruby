<div class="row switch-content <%= "active" if index == 1 %>" data-switch-group="shipping-tab" data-switch-index="<%= "shipping-" + index.to_s %>">
  <div class="col-9">
    <p>
      <%= link_to "Add Pallet", "", data: { reflex: "click->OrderReflex#build_pallet_shipping", shipping_detail_id: f.object.id, user_id: current_user.id }, class: "mr-4" %>
      <%= link_to "Add Loose Box", "", data: { reflex: "click->OrderReflex#build_loose_box_shipping", shipping_detail_id: f.object.id, user_id: current_user.id } %>
    </p>
  </div>

  <div class="col-3 text-right">
    <%= f.select :status, options_for_select(ShippingDetail.statuses.keys.map { |w| w.titleize == "Printed Bol" ? next : [w.titleize, w] }, :selected => f.object.status), {}, data: { reflex: "change->OrderReflex#status_update", user_id: current_user.id, shipping_id: f.object.id, reflex_dataset: "combined" }, class: "form-control" %>
  </div>

  <div class="col-8 mb-3">
    <span class="mr-3">Local Pickup</span>
    <%= f.check_box :local_pickup, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined", switch: "blue"} %>
    <%= f.label :local_pickup, "&nbsp;".html_safe, class: "mr-4" %>

    <span class="mr-3">WGD Upgrade</span>
    <%= f.check_box :white_glove_delivery, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined", switch: "blue" } %>
    <%= f.label :white_glove_delivery, "&nbsp;".html_safe, class: "mr-4" %>

    <span class="mr-3">Remote</span>
    <%= f.check_box :remote, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined", switch: "blue"} %>
    <%= f.label :remote, "&nbsp;".html_safe, class: "mr-4" %>

    <span class="mr-3">Overhang</span>
    <%= f.check_box :overhang, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined", switch: "blue"} %>
    <%= f.label :overhang, "&nbsp;".html_safe, class: "mr-4" %>
  </div>

  <div class="col-4 text-right mb-3">
    <% if f.object.eta_from.present? || f.object.eta_to.present? %>
      <span class="mr-1">ETA Date</span>
      <a data-toggle="modal" data-target="#etaModal-<%= f.object.id %>">
        <% if f.object.eta_from&.to_date&.year == f.object.eta_to&.to_date&.year %>
          <%= f.object.eta_from&.to_date&.strftime("%B %d") %> - <%= f.object.eta_to&.to_date&.strftime("%B %d, %Y") %>
        <% else %>
          <%= f.object.eta_from&.to_date&.strftime("%B %d, %Y") %> - <%= f.object.eta_to&.to_date&.strftime("%B %d, %Y") %>
        <% end %>
      </a>
    <% else %>
      <span class="mr-1">ETA Date</span>
      <a data-toggle="modal" data-target="#etaModal-<%= f.object.id %>">Edit</a>
    <% end %>
  </div>

  <% if f.object.pallet_shippings.present? %>
    <%= f.fields_for :pallet_shippings, f.object.pallet_shippings.order(:created_at) do |pallet_shipping_attributes| %>
      <%= render "pallet_shipping_fields", ff: pallet_shipping_attributes %>
    <% end %>
    <div class="col-6 mb-3">
      Total Packages: <%= f.object.pallet_shippings.count %>
    </div>
    <div class="col-6 mb-3 text-right">
      Total Weight: <%= f.object.pallet_shippings.pluck(:weight).map(&:to_i).sum %>
    </div>
  <% end %>
  
  <% if f.object.line_items.where(order_from: nil).present? %>
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-borderless table-hover">
          <thead>
            <tr>
              <th style="width: 20%">SKU</th>
              <th style="width: 20%">Qty</th>
              <th style="width: 20%">Carton</th>
              <th style="width: 20%">Weight</th>
              <th style="width: 20%">Pallet [#]</th>
            </tr>
          </thead>
          <tbody>
            <%= order.fields_for :line_items do |ff| %>
              <% if (f.object.line_items.ids&.include? ff.object.id) && !(ff.object&.order_from == "CTUS") && !(ff.object&.order_from == "CTCA") %>
                <% if !(ff.object&.title&.include? "Swatch" or ff.object&.sku.length < 3) && !(ff.object&.sku&.include? "warranty") && !(ff.object&.sku == "WGS001") && !(ff.object&.sku == "HLD001") && !(ff.object&.sku == "HFE001") && !(ShipmentCode.pluck(:sku_for_discount)&.include? ff.object&.sku) %>
                  <tr>
                    <td>
                      <% if ProductVariant.find_by(id: ff.object.variant_id).present? %>
                        <%= link_to ff.object.sku, admin_product_variant_path(ff.object.variant_id) %>
                      <% else %>
                        <%= ff.object.sku %>
                      <% end %>
                    </td>
                    <td><%= ff.object.quantity %></td>
                    <td>
                      <% if ff.object&.variant.present? && ff.object&.variant&.product.present? %>
                        <%= ff.object&.variant&.product&.carton_details.count %>
                      <% else %>
                        --
                      <% end %>
                    </td>
                    <td>
                      <% if ff.object&.variant.present? && ff.object&.variant&.product.present? %>
                        <%= ff.object&.variant&.product&.carton_details.sum { |cd| cd.weight.to_f } * ff.object.quantity.to_i %>
                      <% else %>
                        --
                      <% end %>
                    </td>
                    <td>
                      <%= ff.select :pallet_shipping_id, options_for_select((f.object.pallet_shippings.order(:created_at)).each_with_index.map { |ps, j| [ f.object.pallet_shippings.count == 1 && ps.pallet_type == "loose_box" ? "Loose Box" : "#{ps.pallet_type&.titleize} #{j+1}", ps.id ] }, :selected => ff.object.pallet_shipping_id), { include_blank: true }, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined" }, class: "form-control" %>
                    </td>
                  </tr>
                <% end %>
              <% end %>
            <% end %>      
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
  
  <div class="col-12">
    <span class="header2">Shipping</span>
  </div>

  <div class="col-6 mb-3">
    <%= f.label :carrier_id, "Freight Carrier" %>
    <input class="form-control" type="text" disabled value="<%= Carrier.find_by(id: f.object.carrier_id).name if f.object.carrier_id.present? %>">
  </div>

  <div class="col-6 mb-3">
    <label class="mr-2">Shipping Cost</label>
    <a data-toggle="modal" data-target="#shippingCostModal-<%= f.object.id %>">Edit</a>
            
    <% shipping_cost = 0 %>
    <% shipping_cost += f.object&.actual_invoiced&.to_f if f.object.actual_invoiced.present? %>
    <% shipping_cost += f.object&.white_glove_fee&.to_f if f.object.white_glove_fee.present? %>
    <% shipping_cost += f.object&.local_white_glove_delivery&.to_f if f.object.local_white_glove_delivery.present? %>
    <% shipping_cost += f.object.shipping_costs.where(cost_type: "charges")&.sum(:amount) %>
    <input class="form-control" type="text" disabled value="<%= number_to_currency(shipping_cost) %>">
  </div>

  <div class="col-6 mb-3">
    <%= f.label :tracking_number, "Tracking Number" %>
    <%= f.text_field :tracking_number, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined" }, class: "form-control" %>
  </div>

  <div class="col-6 mb-3">
    <label>Tracking URL</label>
    <% if f.object.carrier_id.present? %>
      <input class="form-control" type="text" disabled value="<%= f.object.try(:carrier).try(:tracking_url) %>">
    <% else %>
      <input class="form-control" type="text" disabled>
    <% end %>
  </div>

  <div class="col-12 mb-3">
    <%= link_to "Sync Tracking Info", create_shipment_admin_orders_path(order_id: @order.id, ship_id: f.object.id), class: "btn btn-secondary loader", id: "createShipmentLink" %>
  </div>

  <div class="col-12 mb-3">
    <div class="file-input-container" id="dropzone">
      <%= f.file_field :files, multiple: true, accept: ".pdf" %>
      <span class="font-weight-bold">Drop files here or click to upload</span>
      <p>(File format: pdf only. File size no larger than 10MB per file.)</p>
      <div class="d-flex justify-content-center">
        <div class="col-4">
          <button class="btn btn-light-blue file-input w-100" type="button">
            Browse Files
          </button>
        </div>
        <div class="col-1 text-center">or</div>
        <div class="col-4">
          <div class="dropdown w-100">
            <div class="btn btn-primary w-100 dropdown-toggle arrow-none" data-toggle="dropdown">
              Generate Files <%= show_svg("arrow.svg") %>
            </div>
            <div class="dropdown-menu">
              <a onclick="window.open('<%= pdf_admin_orders_path(ship_status: 'staging', ship_ids: f.object.id) %>', 'print', 'height=750px, width=800px')">
                <div class="dropdown-item">Packing Slip</div>
              </a>
              <a onclick="window.open('<%= pdf_admin_orders_path(ship_status: 'booked', ship_ids: f.object.id) %>', 'print','height=750px, width=800px')">
                <div class="dropdown-item">Bill of Lading</div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% if f.object.files.present? %>
    <div class="col-12 mb-3">
      <div class="table-responsive">
        <table class="table table-borderless table-hover">
          <thead>
            <tr>
              <th>Name</th>
              <th>Size</th>
              <th>Updated</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% f.object.files.each do |doc| %>
              <tr> 
                <% if doc.created_at? %>
                  <td><%= link_to doc.filename, doc, target: :_blank  %></td>
                  <td><%= (doc.byte_size / (1024.0 * 1024.0)).round(2) %>MB</td>
                  <td><%= doc.created_at.to_date.strftime('%B %d, %Y') %></td>
                  <td>
                    <%= link_to delete_upload_admin_order_path(@order, doc_id: doc), method: :delete, data: { confirm: "Are you sure you want to delete this file?" } do %>
                      <%= show_svg("close.svg") %>
                    <% end %>
                  </td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
</div>

<!-- shipping_cost MODAL-->
<div class="modal" id="shippingCostModal-<%= f.object.id %>" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content modal-full-size switch-content active" data-switch-group="shipping-modal" data-switch-index="shipping-main">
      <div class="modal-header">
        <span class="header2 modal-title">Shipping Cost</span>
        <button type="button" class="close" data-dismiss="modal">
          <span class="text-black"><%= show_svg("close.svg") %></span>
        </button>
      </div>

      <div class="modal-body" style="overflow: initial">
        <div class="row mx-0">
          <div class="col-7 mb-3">
            <label>
              <% if f.object.carrier_id.present? %>
                <%= Carrier.find_by(id: f.object.carrier_id).name %> Invoice
              <% else %>
                Frieght Carrier Invoice
              <% end %>
            </label>
            <a class="switch-tab ml-2" data-switch-group="shipping-modal" data-switch-index="shipping-quote">Quote</a>
          </div>
          <div class="col-5 mb-3">              
            <input class="form-control" type="text" disabled value="<%= f.object.actual_invoiced if f.object.actual_invoiced.present? %>">
          </div>

          <div class="col-7 mb-3">
            <label>Shipping ID</label>
            <a class="switch-tab ml-2" data-switch-group="shipping-modal" data-switch-index="shipping-consolidate">Consolidate</a>
          </div>
          <div class="col-5 mb-3">
            <input class="form-control" type="text" disabled value="<%= f.object.consolidation.name if f.object.consolidation.present? %>">
          </div>

          <div class="col-7 mb-3">
            <label>
              <% if f.object.white_glove_directory.present? %>
                <%= f.object.white_glove_directory.company_name %> Delivery
              <% elsif f.object.white_glove_address.present? %>
                <%= f.object.white_glove_address.company %> Delivery
              <% else %>
                White Glove Delivery
              <% end %>
            </label>
            <a class="switch-tab ml-2" data-switch-group="shipping-modal" data-switch-index="shipping-white-glove">Edit</a>
          </div>
          <div class="col-5 mb-3">
            <%= f.text_field :white_glove_fee, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined",  reflex_root: "#shippingCostModal-" + f.object.id.to_s }, class: "form-control" %>
          </div>

          <div class="col-7 mb-3">
            <label>Local White Glove Delivery</label>
          </div>
          <div class="col-5 mb-3">
            <%= f.number_field :local_white_glove_delivery, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined",  reflex_root: "#shippingCostModal-" + f.object.id.to_s }, class: "form-control" %>
          </div>

          <div class="col-7 mb-2 font-weight-bold">Additional Charges</div>
          <div class="col-4 mb-2 font-weight-bold">Amount</div>
          <div class="col-1 mb-2">
            <a data-reflex="click->OrderReflex#create_cost" data-ship-id="<%= f.object.id %>" data-cost-type="charges" data-reflex-root="#shippingCostModal-<%= f.object.id.to_s %>">
              <%= show_svg("plus.svg") %>
            </a>
          </div>
          <div class="w-100 mb-3 border-bottom"></div>
            
          <%= f.fields_for :shipping_costs, f.object.shipping_costs.where(cost_type: "charges").order(:created_at) do |cost| %>
            <div class="col-7 mb-3">
              <%= cost.select :name, options_for_select(IssueDetail.shipping_charges.keys.map { |w| [w.titleize, w.titleize] }, :selected => cost.object.name), { include_blank: true }, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined",  reflex_root: "#shippingCostModal-" + f.object.id.to_s }, class: "form-control mb-3" %>
            </div>

            <div class="col-4 mb-3">
              <%= cost.number_field :amount, step: :any, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined", reflex_root: "#shippingCostModal-" + f.object.id.to_s }, class: "form-control" %>
            </div>

            <div class="col-1 mb-3">
              <a data-reflex="click->OrderReflex#delete_cost" data-cost-id="<%= cost.object.id %>" data-reflex-root="#shippingCostModal-<%= f.object.id.to_s %>">
                <%= show_svg("close.svg") %>
              </a>
            </div>
          <% end %>

          <div class="col-7 pt-3 border-top">
            <span class="text-black font-weight-bold">Total Shipping Cost</span>
          </div>
          <div class="col-5 pt-3 border-top">
            <% charge_total = f.object&.actual_invoiced.to_f + f.object&.local_white_glove_delivery.to_f + f.object&.white_glove_fee.to_f %>
            <% charge_total += f.object.shipping_costs.where(cost_type: "charges")&.sum(:amount) %>
            <span class="text-black font-weight-bold"><%= number_to_currency(charge_total) %></span>
          </div>
        </div>
      </div>
          
      <div class="modal-header">
        <span class="header2 modal-title">Customer Cost</span>
      </div>

      <div class="modal-body" style="overflow: initial">
        <div class="row mx-0">
          <% if @order&.shipping_line&.price.present? %>
            <div class="col-7 mb-3 font-weight-bold">
              Customer Invoiced
            </div>
            <div class="col-5 mb-3">
              <%= number_to_currency(@order&.shipping_line&.price) %>
            </div>
          <% end %>

          <div class="col-7 mb-2 font-weight-bold">Additional Fees</div>
          <div class="col-4 mb-2 font-weight-bold">Amount</div>
          <div class="col-1 mb-2">
            <a data-reflex="click->OrderReflex#create_cost" data-ship-id="<%= f.object.id %>" data-cost-type="fees" data-reflex-root="#shippingCostModal-<%= f.object.id.to_s %>">
              <%= show_svg("plus.svg") %>
            </a>
          </div>
          <div class="w-100 mb-3 border-bottom"></div>
            
          <%= f.fields_for :shipping_costs, f.object.shipping_costs.where(cost_type: "fees").order(:created_at) do |cost| %>
            <div class="col-7 mb-3">
              <%= cost.text_field :name, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined",  reflex_root: "#shippingCostModal-" + f.object.id.to_s }, class: "form-control" %>
            </div>
            <div class="col-4 mb-3">
              <%= cost.number_field :amount, step: :any, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined",  reflex_root: "#shippingCostModal-" + f.object.id.to_s }, class: "form-control" %>
            </div>
            <div class="col-1 mb-3">
              <a data-reflex="click->OrderReflex#delete_cost" data-cost-id="<%= cost.object.id %>" data-reflex-root="#shippingCostModal-<%= f.object.id.to_s %>">
                <%= show_svg("close.svg") %>
              </a>
            </div>
          <% end %>

          <div class="col-7 pt-3 border-top">
            <span class="text-black font-weight-bold">Total Customer Cost</span>
          </div>
          <div class="col-5 pt-3 border-top">
            <% customer_total = @order.try(:shipping_line).try(:price).to_f %>
            <% customer_total += f.object.shipping_costs.where(cost_type: "fees")&.sum(:amount) %>
            <b><%= number_to_currency(customer_total) %></b>
          </div>
        </div>
      </div>

      <div class="modal-body" style="overflow: initial">
        <div class="row mx-0">
          <div class="col-7 mb-3">
            <h5>Net Shipping Cost</h5>
          </div>

          <div class="col-5 mb-3">
            <h5><%= number_to_currency(charge_total - customer_total) %></h5>
          </div>

          <div class="col-12 pt-3 border-top">
            <%= f.label :shipping_notes, "Shipping Notes" %>
            <%= f.text_area :shipping_notes, data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_dataset: "combined", reflex_root: "#shippingCostModal-" + f.object.id.to_s }, class: "form-control mb-3" %>
          </div>
        </div>
      </div>
        
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary mr-4" data-dismiss="modal">Close</button>
        <%= f.submit "Submit", name: "shipping_cost_edit", value: "Submit", class: "btn btn-primary" %>
      </div>
    </div>

    <div class="modal-content switch-content" id="shippingQuote-<%= f.object.id %>" data-switch-group="shipping-modal" data-switch-index="shipping-quote">
      <div class="modal-header">
        <span class="header2 modal-title">Carrier Quotations</span>
        <button type="button" class="close" data-dismiss="modal">
          <span class="text-black"><%= show_svg("close.svg") %></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row mx-0">
          <div class="col-12 mb-3">
            <div class="table-responsive">
              <table class="table table-borderless table-hover">
                <thead>
                  <tr>
                    <th style="width: 30%">Broker</th>
                    <th style="width: 30%">Carrier</th>
                    <th style="width: 30%">Amount</th>
                    <th style="width: 5%"></th>
                    <th style="width: 5%">
                      <a data-reflex="click->OrderReflex#create_quote" data-ship-id="<%= f.object.id %>" data-reflex-root="#shippingQuote-<%= f.object.id %>"><%= show_svg("plus.svg") %></a>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <%= f.fields_for :shipping_quotes, f.object.shipping_quotes.order(:id) do |quote| %>
                    <tr>
                      <td>
                        <%= quote.select :truck_broker_id, options_for_select(TruckBroker.where(country: order.object.store).map { |s| [s.name, s.id]}, quote.object.truck_broker_id), { include_blank: true }, class: "form-control", data: { quote_id: quote.object.id } %>
                      </td>
                      <td>
                        <%= quote.select :carrier_id, options_for_select(Carrier.where(inactive: false).map { |s| [s.name, s.id, { "data-quote-id": quote.object.id, "data-broker-id": s.truck_broker_id }]}, quote.object.carrier_id), { include_blank: true }, class: "form-control" %>
                      </td>
                      <td><%= quote.number_field :amount, step: :any, class: "form-control", data: { user_id: current_user.id } %></td>
                      <td style="vertical-align: middle">
                        <label class="checkbox checkbox-blue radio">
                          <%= quote.check_box :selected, data: { user_id: current_user.id } %>
                          <span class="checkmark"></span>
                        </label>
                      </td>
                      <td>
                        <a data-reflex="click->OrderReflex#delete_quote" data-quote-id="<%= quote.object.id %>" data-reflex-root="#shippingQuote-<%= f.object.id %>"><%= show_svg("close.svg") %></a>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-12">
            <%= f.label :note %>
            <%= f.text_area :note, class: "form-control" %>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary switch-tab mr-4" data-switch-group="shipping-modal" data-switch-index="shipping-main">Cancel</button>
        <button type="button" class="btn btn-primary" data-reflex="click->OrderReflex#update" data-user-id="<%= current_user.id %>" data-reflex-root="#shippingCostModal-<%= f.object.id %>">Submit</button>
      </div>
    </div>

    <div class="modal-content switch-content" id="shippingConsolidate-<%= f.object.id %>" data-switch-group="shipping-modal" data-switch-index="shipping-consolidate">
      <div class="modal-header">
        <span class="header2 modal-title">Group Shipment</span>
        <button type="button" class="close" data-dismiss="modal">
          <span class="text-black"><%= show_svg("close.svg") %></span>
        </button>
      </div>
      <div class="modal-body" id="consolidate-container-<%= f.object.id %>">
        <div class="search-bar d-inline-block">
          <input type="text" placeholder="Search..." class="form-control" data-reflex="debounced:input->OrderReflex#search_shipment" data-shipping-id="<%= f.object.id %>" data-store-type="<%= current_store %>">
        </div>
        <section id="shipment-search-edit-results" class="mb-3 border-bottom" style="height: 45vh">
          <% render partial: "search_shipment", locals: { current_user: current_user } %>
        </section>
        <label>Selected Shipment</label><br>
        <% if f.object.consolidation.present? %>
          <% f.object.consolidation.shipping_details.each do |s| %>
            <span class="tag">
              <%= s.order.name %> (<%= get_shipping s %>)
              <span data-reflex="click->OrderReflex#remove_consolidate" data-reflex-root="#consolidate-container-<%= f.object.id %>" data-id="<%= s.id %>">
                <%= show_svg("close.svg") %>
              </span>
            </span>
          <% end %>
        <% else %>
          <span class="tag" data-id="<%= f.object.id %>">
            <%= f.object.order.name %> (<%= get_shipping f.object %>)
          </span>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary switch-tab mr-4" data-switch-group="shipping-modal" data-switch-index="shipping-main">Cancel</button>
        <button class="btn btn-primary" type="button" data-reflex="click->OrderReflex#update" data-user-id="<%= current_user.id %>" data-reflex-root="#shippingCostModal-<%= f.object.id %>">Submit</button>
      </div>
    </div>

    <div class="modal-content switch-content" id="shippingWhiteGlove-<%= f.object.id %>" data-switch-group="shipping-modal" data-switch-index="shipping-white-glove">
      <div class="modal-header pb-0">
        <span class="header2 modal-title">White Glove Address</span>
        <button type="button" class="close" data-dismiss="modal">
          <span class="text-black"><%= show_svg("close.svg") %></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row mx-0">
          <div class="col-6 mb-3">
            <%= f.label :white_glove_directory_id, "Company Name" %>
            <%= f.select :white_glove_directory_id, options_for_select(WhiteGloveDirectory.where(store: current_store).order(:company_name).map { |s| [s.company_name, s.id] }, f.object.white_glove_directory_id), { include_blank: true }, class: "form-control", data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_root: "#shippingWhiteGlove-" + f.object.id.to_s } %>
          </div>

          <div class="col-6 mb-3">
            <%= f.label :white_glove_address_id, "Company Address" %>
            <%= f.select :white_glove_address_id, options_for_select(WhiteGloveAddress.where(white_glove_directory_id: f.object.white_glove_directory_id).map { |s| [s.address1.to_s + ", " + s.address2.to_s, s.id] }, f.object.white_glove_address_id), { include_blank: true }, class: "form-control", data: { reflex: "change->OrderReflex#update", user_id: current_user.id, reflex_root: "#shippingWhiteGlove-" + f.object.id.to_s } %>
          </div>

          <div class="col-12 mb-3 border-bottom"></div>

          <div class="col-6 mb-3">
            <label>Company Name</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_directory.company_name if f.object.white_glove_directory.present? %>" disabled>
          </div>

          <div class="col-6 mb-3">
            <label>Contact</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_address.contact if f.object.white_glove_address.present? %>" disabled>
          </div>

          <div class="col-6 mb-3">
            <label>Address</label><%= f.object.white_glove_address.present? %>
            <input type="text" class="form-control" value="<%= f.object.white_glove_address.address1 if f.object.white_glove_address.present? %>" disabled>
          </div>

          <div class="col-6 mb-3">
            <label>City</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_address.city if f.object.white_glove_address.present? %>" disabled>
          </div>

          <div class="col-4 mb-3">
            <label>State</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_address.address2 if f.object.white_glove_address.present? %>" disabled>
          </div>

          <div class="col-4 mb-3">
            <label>Country</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_directory.store.upcase if f.object.white_glove_directory.present? %>" disabled>
          </div>

          <div class="col-4 mb-3">
            <label>Zip Code</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_address.zip if f.object.white_glove_address.present? %>" disabled>
          </div>

          <div class="col-6 mb-3">
            <label>Phone</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_address.phone if f.object.white_glove_address.present? %>" disabled>
          </div>

          <div class="col-6 mb-3">
            <label>Email</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_address.email if f.object.white_glove_address.present? %>" disabled>
          </div>

          <div class="col-6 mb-3">
            <label>Receiving Hours</label>
            <input type="text" class="form-control" value="<%= f.object.white_glove_address.receiving_hours if f.object.white_glove_address.present? %>" disabled>
          </div>

          <div class="col-6 mb-3">
            <p class="form-check-label mb-2">Delivery Notification Required</p>
            <input id="<%= f.object.id %>-white-glove-delivery-notification" type="checkbox" data-switch="blue" <%= "checked" if f.object.white_glove_address&.delivery_notification %> disabled>
            <label for="<%= f.object.id %>-white-glove-delivery-notification">&nbsp;</label>
          </div>

          <div class="col-12 mb-3">
            <label>White Glove Notes</label>
            <textarea class="form-control" value="<%= f.object.white_glove_address.notes if f.object.white_glove_address.present? %>" disabled></textarea>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary switch-tab mr-4" data-switch-group="shipping-modal" data-switch-index="shipping-main">Back</button>
      </div>
    </div>
  </div>
</div>

<!-- eta_date MODAL -->
<div class="modal" id="etaModal-<%= f.object.id %>" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <span class="header2 modal-title">ETC Date</span>
        <button type="button" class="close" data-dismiss="modal">
          <span class="text-black"><%= show_svg("close.svg") %></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row mx-0">
          <div class="col-6 mb-3">
            <%= f.label :eta_from, "From" %>
            <%= f.date_field :eta_from, class: "form-control" %>
          </div>
          <div class="col-6 mb-3">
            <%= f.label :eta_to, "To" %>
            <%= f.date_field :eta_to, class: "form-control" %>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary mr-4" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  window.onload = function(){
    console.log(document.getElementById('loaderOverlay').style.display);
    document.getElementById('loaderOverlay').style.display = 'none';
  }

  $("#createShipmentLink").on("click", function() {
    document.getElementById('loaderOverlay').style.display = "flex";
  });
</script>

<script type="text/javascript">
  $("input[type='checkbox']").on("change", function() {
    if ($(this)[0].checked) {
      $(this).parents(".table").find("input[type='checkbox']").prop("checked", false);
      $(this).prop("checked", true);
    }
  });
</script>

<script type="text/javascript">
  $(document).on("click", ".switch-tab", function() {
    $("select[data-quote-id]").each(function() {
      quote = $(this).data("quote-id");
      broker = $(this).val();
      $("option[data-quote-id='" + quote + "']").hide();
      $("option[data-quote-id='" + quote + "'][data-broker-id='" + broker + "']").show();
    });
  });

  $("select[data-quote-id]").on("change", function() {
    quote = $(this).data("quote-id");
    broker = $(this).val();
    $("option[data-quote-id='" + quote + "']").hide();
    $("option[data-quote-id='" + quote + "'][data-broker-id='" + broker + "']").show();
  });
</script>